# node.js 특징

## V8 엔진

- 빠른 코드 실행
- V8 엔진을 인터프리터로 사용 <br>
  인터프리터: 고급 언어로 작성된 명령어들을 한번에 한줄씩 읽으면서 실행하는 방식

## 단일스레드

- 하나의 스레드가 모든 작업을 수행한다.
- 스레드가 1개이기때문에 메모리 사용량과 시스템 리소스 사용량 변화가 크지 않다.
- 대규모 네트워크 프로그램을 개발하기 적합하다.
- 스레드가 한개이기 때문에 고장나면 프로그램 전체에 문제가 발생한다.
- 멀티스레드의 경우 Context Swtiching을 이용하여 어러 작업을 동시에 처리하는 것 같이 느끼게 하지만, <br>오히려 switching하는 시간때문에 총 작업시간이 더 걸릴 수 있다.
- CPU 사용률이 높은 어플리케이션에서는 Node.js 사용 권장 X

## 이벤트 기반 비동기 방식

### 스레드 기반 동기 방식 (Blocking I/O)

- 하나의 스레드가 request를 받으면 모든 처리가 완료될 때 까지 기다렸다가 처리하고, 결과가 완료되면 다시 응답을 보낸다.
- 기존 업무 처리가 완료되기 전에 또 다른 request가 있으면 새로운 스레드 업무를 시작한다.
- 동시 request가 많은 경우, 많은 스레드가 필요하여 서버 과부하가 일어난다.

- 어플리케이션에서 커널에 system call을 보낸 후 커널은 파일을 읽기 위한 동작을 수행하고, <br>어플리케이션은 커널이 파일을 다 읽을 때까지 기다려야한다. <br>
  이 상태를 어플리케이션이 block됐다고 표현하며, 실제로 이 시간동안 어플리케이션은 아무 동작을 하지 않는다.

### 이벤트 루프 기반의 비동기 방식 (Non-Blocking I/O)

- 작업을 요청하면서 그 작업이 완료되었을 때, 어떤 작업을 진행할 지에 대한 콜백함수를 지정하여 동작이 완료되었을 때 해당 콜백함수가 실행되는 방식이다.
- 클라이언트가 웹 서버에 HTTP 요청을 하게 되면, 서버에서는 이벤트 루프가 요청을 감지하고 워커 스레드를 생성하여 알맞은 작업을 실행한다. 이 때, 이벤트 루프는 해당 워커 스레드가 작업을 마친 뒤 그 결과와 함께 응답할때까지 기다리는것이 아니라 바로 루프로 복귀하여 다른 요청을 기다리게 된다.
- 즉, 이벤트 루프는 어떤 요청이 발생하면 그 작업에 대해 스레드 실행만 일으킨다. 이후 작업을 할당받았던 해당 스레드가 모든 작업을 마치면 미리 전달받은 콜백함수를 실행하여 이벤트 루프로 응답, 실행하여 클라이언트에게 결과를 보내준다.
- Node.js로 개발된 프로세스는 이벤트 큐에 등록된 새로운 이벤트를 탐지한다.
- 요청이 동시에 발생하여도 처리가 완료될때까지 기다리지 않아 서버 부하가 적다.

### Thread Pool

- Node.js 어플리케이션 자체는 단일 스레드로 실행되지만, background에서 thread pool을 구성해 작업을 수행한다. thread pool을 관리하는 것은 개발자가 아니라 플랫폼이다. 개발자는 스레드 하나를 관리하듯 프로그래밍하면 플랫폼이 여러 스레드를 효율적으로 운용한다.
